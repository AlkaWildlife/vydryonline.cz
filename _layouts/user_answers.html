---
layout: default
---
{% for user_answer in site.user_answers %}
  {% assign tags = tags | concat: user_answer.tags | uniq %}
{% endfor %}

{% assign filterable_tags = site.filterable_tags | sort: "position" %}
{% for filterable_tag in filterable_tags %}
  {% unless tags contains filterable_tag.name %}
    {% continue %}
  {% endunless %}
  {% comment %}
    The filter concat works only with array (at least that’s what
    Liquid documentation says). That is why filterable_tag cannot be
    used. So, we find the same tag again but keep it in array, so it
    can be concatenated.
  {% endcomment %}
  {% assign matching_tags = site.filterable_tags |
       where: "id", filterable_tag.id %}
  {% assign filtered_tags = filtered_tags | concat: matching_tags %}
{% endfor %}

<div id="content-row">
  <div class="row-container">
    <div class="container-fluid">
      {% include breadcrumb.html %}
      <div class="content-inner row-fluid">
        <!-- Left sidebar -->
        <div id="component" class="span8">

          <div class="page-blog page-blog__">
            <div class="page_header">
              <h3>
                {% assign url_parts = page.url | split: "/" %}
                {% if url_parts > 2 %}
                  {% assign cardinatlity = 'many' %}
                {% else %}
                  {% assign cardinatlity = 'one' %}
                {% endif %}
                <span class="item_title_part0">{{ site.data.user_answers.title[cardinatlity] }}</span>
              </h3>
            </div>
            {{ content }}
          </div>
        </div>
        <!-- Right sidebar -->
        <div id="aside-right" class="span4">
          <aside>
            <div class="moduletable ">
              <h3 class="moduleTitle ">{{ site.data.user_answers.filter.by_tag }}</h3>
              <ul class="categories-module">
                <li id="filter_by_category_all" hidden>
                  <p>
                    <a href="{{ "/user-answers" | relative_url }}#">Zobrazit vše</a>
                    <br/>
                  </p>
                </li>

                {% for filtered_tag in filtered_tags %}
                  {% capture tag_slug -%}
                    {% include helpers/slug.html page=filtered_tag %}
                  {%- endcapture %}
                  <li>
                    <a href="{{ "/user-answers" | relative_url }}#category={{ tag_slug }}">
                      {{ filtered_tag.name }}
                    </a>
                  </li>
                {% endfor %}
              </ul>
            </div>
            <div class="moduletable ">
              <h3 class="moduleTitle ">{{ site.data.user_answers.filter.by_date }}</h3>

              <ul class="archive-module">
                <li id="filter_by_date_all" hidden>
                  <p>
                    <a href="{{ "/user-answers" | relative_url }}#">Zobrazit vše</a>
                    <br/>
                  </p>
                </li>

                {% assign first_user_answer = site.user_answers | last %}
                {% assign one_month = 2678400 %}
                {% assign previous_date = first_user_answer.date |
                     plus: one_month |
                     date: "%Y-%m" %}

                {% for user_answer in site.user_answers %}
                  {% assign from = user_answer.date | date: "%Y-%m" %}
                  {% if from == previous_date %}{% continue %}{% endif %}

                  <li>
                    <a href="{{ "/user-answers" | relative_url }}#from={{ from }}&amp;to={{ previous_date }}">{{ user_answer.date | date: "%-m/%Y" }}</a>
                  </li>
                  {% assign previous_date = user_answer.date | date: "%Y-%m" %}
                {% endfor %}
              </ul>
            </div>
            <div class="moduletable aside">
              {% include question_form.html %}
            </div>
          </aside>
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  (function(w, d) {
    if (typeof [].map !== "function") return
    if (typeof [].reduce !== "function") return
    if (!("onpopstate" in w)) return
    if (!("dateTime" in d.createElement("TIME"))) return

    function paramsFromHash(hash) {
      return !hash ? {} : hash.
        slice(1).
        split("&").
        map(function(rawPair) { return rawPair.split("=", 2) }).
        reduce(function(params, pair) {
          params[pair[0]] = pair.length === 2 ? pair[1] : true
          return params
        }, {})
    }

    function toggleShowAll(params) {
      if (params["category"]) {
        d.getElementById("filter_by_category_all").hidden = false
      } else {
        d.getElementById("filter_by_category_all").hidden = true
      }

      if (params["from"] || params["to"]) {
        d.getElementById("filter_by_date_all").hidden = false
      } else {
        d.getElementById("filter_by_date_all").hidden = true
      }
    }

    function filterByCategory(category) {
      var userAnswers = d.getElementsByClassName("js-user-answer")
      var filterAnchor, params, i;
      for (i = 0; i < userAnswers.length; i += 1) {
        filterAnchor = userAnswers[i].
          getElementsByClassName("js-user-answer-category")[0]
        params = paramsFromHash("#" + filterAnchor.href.split("#", 2)[1])
        userAnswers[i].hidden = !(!category || category === params["category"])
      }
    }

    function filterByDate(from, to) {
      if (from) from = new Date(from)
      if (to) from = new Date(to)

      var userAnswers = d.getElementsByClassName("js-user-answer")
      var filterDate, i;
      for (i = 0; i < userAnswers.length; i += 1) {
        filterDate = new Date(
          userAnswers[i].
            getElementsByClassName("js-user-answer-date")[0].
            dateTime
        )
        userAnswers[i].hidden = !((!from || from <= filterDate) &&
                                  (!to   || to   >= filterDate))
      }
    }

    function filter(ev) {
      var params = paramsFromHash(ev.target.location.hash)
      toggleShowAll(params)
      filterByCategory(params["category"])
      filterByDate(params["from"], params["to"])
    }

    w.addEventListener("onpopstate", filter, false)
    w.addEventListener("load", filter, false)
    d.addEventListener("DOMContentLoaded", function(ev) {
      w.removeEventListener("load", filter, false)
      filter(ev)
    }, false)
  }(window, document))
</script>
